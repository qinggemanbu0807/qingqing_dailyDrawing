<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>情情老公的专属特权卡池</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Inter 字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, #f7f3f3 0%, #f0e6ff 100%); /* 柔和渐变背景 */
            min-height: 100vh;
        }
        /* 确保容器具有 3D 效果 */
        .card-container {
            transform-style: preserve-3d;
            perspective: 1000px; /* 添加透视效果 */
            height: 50vh; /* 使用视口高度，更好地适配手机屏幕 */
            max-height: 400px; /* 限制最大高度 */
        }
        /* 卡片内部，控制整体翻转 */
        .card-inner {
            transition: transform 0.8s;
            transform-style: preserve-3d;
            position: relative;
        }
        /* 默认状态下，正面（结果）是背面朝上 */
        .card-face {
            backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
            transform: rotateY(180deg); /* 默认背面朝上 */
        }
        /* 默认状态下，背面（点击抽卡）是正面朝上 */
        .card-back {
            backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
            transform: rotateY(0deg); /* 默认正面朝上 */
        }

        /* 翻转状态：整个内部容器旋转 180 度 */
        .flipped .card-inner {
            transform: rotateY(180deg);
        }

        /* 稀有度颜色 */
        .rarity-S { 
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); 
            color: #8B4513; 
            border: 5px solid #FFD700; /* 边框加粗 */
            box-shadow: 0 4px 30px rgba(255, 215, 0, 0.8); /* 阴影更明显 */
        }
        .rarity-A { 
            background: linear-gradient(135deg, #A8A8A8 0%, #696969 100%); 
            color: #FFFFFF; 
            border: 5px solid #A8A8A8; 
            box-shadow: 0 4px 20px rgba(168, 168, 168, 0.6); 
        }
        .rarity-B { 
            background: linear-gradient(135deg, #B0E0E6 0%, #87CEEB 100%); 
            color: #333333; 
            border: 5px solid #B0E0E6; 
            box-shadow: 0 4px 10px rgba(135, 206, 235, 0.4);
        }
        
        /* 标题文字阴影 */
        .text-shadow {
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-md mx-auto flex flex-col items-center justify-center text-center py-8">
        <!-- 标题 -->
        <h1 class="text-4xl font-black text-gray-800 mb-6 tracking-tight text-shadow">
            ✨ 情情老公的专属卡池 ✨
        </h1>
        <p class="text-gray-500 mb-8 text-base">每天一次，王锐的特权由你决定！</p>

        <!-- 抽卡结果区域 -->
        <div id="card-result" class="card-container w-full">
            <div id="card-inner" class="card-inner h-full w-full">
                
                <!-- 卡片背面 (初始状态) -->
                <div id="card-back" class="card-back w-full h-full rounded-2xl bg-gradient-to-br from-pink-500 to-red-600 flex items-center justify-center border-4 border-pink-200 shadow-xl p-6">
                    <span class="text-white text-3xl font-extrabold tracking-widest text-shadow">点击抽卡</span>
                </div>

                <!-- 卡片正面 (结果显示) -->
                <div id="card-face" class="card-face w-full h-full rounded-2xl p-6 shadow-2xl flex flex-col justify-between items-center text-center">
                    <div class="text-4xl font-black mb-2 text-shadow" id="rarity-display"></div>
                    <p class="text-base font-medium mb-4 text-gray-700" id="description-display"></p>
                    <div class="text-xl font-extrabold p-3 rounded-full w-full shadow-md" id="title-display"></div>
                </div>
            </div>
        </div>

        <!-- 按钮区域 -->
        <button id="draw-button" onclick="drawCard()" class="w-full mt-10 py-5 px-6 bg-pink-500 hover:bg-pink-600 text-white font-black rounded-2xl shadow-xl transform transition duration-150 active:scale-95 text-xl tracking-wider">
            抽取今日特权卡！
        </button>

        <!-- 提示信息 -->
        <p id="message" class="mt-4 text-sm text-red-600 font-semibold hidden p-3 bg-red-100 rounded-lg w-full max-w-xs mx-auto shadow">今日特权已使用，明天再来哦！</p>
    </div>

    <script>
        // 卡片数据：稀有度、标题、描述
        const cardData = {
            'S': [
                { title: "【绝对指令权】", desc: "今日锐锐需无条件接受情情的一条指令（限合理范围）！", color: "rarity-S" },
                { title: "【思念的深度提问】", desc: "情情今晚可向锐锐提出两个最私密、最渴望知道的、关于身体的深度问题，锐锐必须如实回答并进行最细节的描述。", color: "rarity-S" },
                { title: "【未来同居夜】", desc: "下次连线，情情可要求锐锐关闭灯光，两人盖上被子，只用私密的‘气音’，互相讲述对未来同居生活的三个最大期待。", color: "rarity-S" },
                { title: "【上帝视角】", desc: "自定义至多五张任意等级的卡，并选择一张立刻执行。", color: "rarity-S" },
                { title: "【恋爱剧本导演】", desc: "情情写一个“小情节”，锐锐必须把它完整演出来（语音/文字/剧情皆可，只要健康不越界）。", color: "rarity-S" }
            ],
            'A': [
                { title: "【抱抱召唤卡】", desc: "情情随时说一声，锐锐就给情情一个抱抱（或语音版抱抱）。", color: "rarity-A" },
                { title: "【指定夸夸卡】", desc: "情情可以要求锐锐针对某个方面夸情情，锐锐必须夸到情情满意为止。", color: "rarity-A" },
                { title: "【甜度升级卡】", desc: "今天情情可以要求锐锐说一句平时不好意思说的情话。", color: "rarity-A" },
                { title: "【小任性保护卡】", desc: "今天情情可以任性一次，锐锐必须无条件接住（小事范围）。", color: "rarity-A" },
                { title: "【睡前陪伴卡】", desc: "今晚锐锐必须陪情情到情情入睡（或能陪到情情安心为止）。", color: "rarity-A" },
                { title: "【今日愿望许可卡】", desc: "情情可以提一个小愿望，锐锐需要在今天完成。", color: "rarity-A" },
                { title: "【随机甜蜜任务卡】", desc: "情情今天可以让锐锐为情情做一件‘超小但超暖心’的事，由情情指定。", color: "rarity-A" },
                { title: "【Loopy宝宝独占】", desc: "获得Loopy宝宝（锐锐）半小时的专属在线表演时间（带头套！）。", color: "rarity-A" },
                { title: "【早睡强制令】", desc: "锐锐今日必须在情情指定的时间睡觉，不许熬夜学习！", color: "rarity-A" }
            ],
            'B': [
                { title: "【小小命令卡】", desc: "情情可以命令锐锐做一件非常小的事情，比如‘喝水’‘拍猫猫手势’。", color: "rarity-B" },
                { title: "【情绪天线卡】", desc: "情情今天说一句“锐锐有点情绪”，锐锐必须马上切换成陪伴模式。", color: "rarity-B" },
                { title: "【语音选手卡】", desc: "情情可以要求锐锐发一条情情指定风格的语音（可爱/低沉/搞怪）。", color: "rarity-B" },
                { title: "【好消息速递卡】", desc: "今天锐锐必须给情情传递三件真实的小好消息。", color: "rarity-B" },
                { title: "【表情包投喂卡】", desc: "情情可以随时喊‘锐锐要’，锐锐必须给情情投喂一波表情包。", color: "rarity-B" },
                { title: "【清醒监督卡】", desc: "情情今天可以监督锐锐一件锐锐想坚持的小事。", color: "rarity-B" },
                { title: "【今日小幸运卡】", desc: "锐锐必须给情情说一件情情今天会遇到的小幸运（预言型）。", color: "rarity-B" },
                { title: "【生活建议卡】", desc: "情情问任何小问题，锐锐必须认真给出一个靠谱建议。", color: "rarity-B" },
                { title: "【情感电量补给卡】", desc: "情情说缺电，锐锐必须立刻补给一句动力话。", color: "rarity-B" },
                { title: "【照片召唤卡】", desc: "情情可以要求锐锐拍一张当下的小照片（场景随缘）。", color: "rarity-B" }
            ]
        };

        // 概率配置
        const rarityChances = {
            'S': 10, // S级 10%
            'A': 30, // A级 30%
            'B': 60  // B级 60%
        };

        const drawButton = document.getElementById('draw-button');
        const cardInner = document.getElementById('card-inner');
        const messageDisplay = document.getElementById('message');

        const lastDrawKey = 'lastDrawDate';

        // --- CST 时间和逻辑函数 ---

        // 获取当前北京时间 (CST, UTC+8)
        function getCSTTime() {
            const now = new Date();
            // 1. 获取当前UTC时间 (ms)
            const utcTime = now.getTime() + (now.getTimezoneOffset() * 60000); 
            // 2. UTC时间 + 8小时 = CST时间 (8 * 60 * 60 * 1000 ms)
            const cstTime = new Date(utcTime + (8 * 3600000));
            return cstTime;
        }

        // 依据 CST 5:00 AM 刷新点，获取当天的日期字符串 (用于 localStorage)
        function getCSTResetDateString(cstTime) {
            const cstHour = cstTime.getHours();
            
            // 如果时间在 00:00 到 04:59 CST 之间，'抽卡日'是前一天 (因为5点才刷新)
            if (cstHour < 5) { // 刷新时间改为 5点
                // 减去 24 小时 (ms)
                const previousDay = new Date(cstTime.getTime() - 24 * 3600000);
                return previousDay.toISOString().slice(0, 10);
            }
            // 否则，'抽卡日'是今天
            return cstTime.toISOString().slice(0, 10);
        }

        // 检查是否在抽卡时间窗内 (CST 5:00 AM - 10:00 AM)
        function checkAccessWindow(cstTime) {
            const cstHour = cstTime.getHours();
            // 5点（含）到 10点（不含）
            return cstHour >= 5 && cstHour < 10;
        }

        // --- 核心逻辑函数 ---

        function checkDrawStatus() {
            const cstTime = getCSTTime();
            const todayResetString = getCSTResetDateString(cstTime);
            const lastDrawDate = localStorage.getItem(lastDrawKey);
            const inWindow = checkAccessWindow(cstTime);

            const alreadyDrawnMessage = '今日特权已抽取，明天北京时间凌晨5点刷新后才能再来哦！'; // 更新提示
            outOfWindowMessage = '今天宝宝没有按时早起哦！请在北京时间早上5点至10点之间再来抽取你的特权！';

            if (!inWindow) {
                drawButton.disabled = true;
                drawButton.classList.add('opacity-50', 'cursor-not-allowed');
                drawButton.textContent = '请在 5:00 - 10:00 抽取';
                messageDisplay.textContent = outOfWindowMessage;
                messageDisplay.classList.remove('hidden');
                return true;
            }

            if (lastDrawDate === todayResetString) {
                drawButton.disabled = true;
                drawButton.classList.add('opacity-50', 'cursor-not-allowed');
                drawButton.textContent = '今日特权已抽取';
                messageDisplay.textContent = alreadyDrawnMessage;
                messageDisplay.classList.remove('hidden');
                return true;
            }

            // 如果在时间窗内且未抽卡
            drawButton.disabled = false;
            drawButton.textContent = '抽取今日特权卡！';
            messageDisplay.classList.add('hidden');
            return false;
        }

        function drawCard() {
            if (checkDrawStatus()) return;

            // 1. 确定抽到的稀有度
            let rand = Math.random() * 100;
            let rarity = '';
            
            if (rand < rarityChances['S']) {
                rarity = 'S';
            } else if (rand < rarityChances['S'] + rarityChances['A']) {
                rarity = 'A';
            } else {
                rarity = 'B';
            }

            // 2. 从该稀有度中随机抽取一张卡
            const cardsOfRarity = cardData[rarity];
            const randomIndex = Math.floor(Math.random() * cardsOfRarity.length);
            const drawnCard = cardsOfRarity[randomIndex];

            // 3. 延迟并翻转卡片
            drawButton.disabled = true;
            drawButton.textContent = '抽取中...';
            
            // 确保卡片初始状态是背面朝上 (CSS 已经设定好)

            setTimeout(() => {
                // 4. 更新卡片内容和样式
                const cardFace = document.getElementById('card-face');
                const titleDisplay = document.getElementById('title-display');
                const descriptionDisplay = document.getElementById('description-display');
                const rarityDisplay = document.getElementById('rarity-display');

                // 清除旧样式，添加新样式
                // 使用 card-face class 来定位，确保样式是正确的
                cardFace.className = 'card-face w-full h-full rounded-2xl p-6 shadow-2xl flex flex-col justify-between items-center text-center';
                cardFace.classList.add(drawnCard.color);
                
                // 更新内容
                rarityDisplay.textContent = '⭐️ ' + rarity + ' 级特权 ⭐️';
                titleDisplay.textContent = drawnCard.title;
                descriptionDisplay.textContent = drawnCard.desc;

                // 5. 翻转卡片 (核心操作：添加 flipped 类)
                document.getElementById('card-result').classList.add('flipped');
                cardInner.classList.add('flipped'); // 添加到 card-inner 元素

                // 6. 锁定抽卡状态
                const cstTime = getCSTTime();
                const todayResetString = getCSTResetDateString(cstTime);
                localStorage.setItem(lastDrawKey, todayResetString);
                
                // 更新按钮状态
                checkDrawStatus(); 

            }, 500); // 延迟0.5秒后开始翻转

        }

        // 页面加载时检查状态
        document.addEventListener('DOMContentLoaded', checkDrawStatus);
        
        // 为了方便调试，每隔一分钟检查一次状态（在真实使用中可以省略）
        // setInterval(checkDrawStatus, 60000); 
    </script>
</body>
</html>